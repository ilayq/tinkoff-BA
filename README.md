# smart-home-binary
Демо-сервер для задачи "умный дом"

## Запуск

Перед запуском в Linux или MacOS убедитесь, что файл имеет права на исполнение. Установить их можно с помощью команды:

```
chmod +x FILE
```

Всегда используйте самую последнюю версию демо-сервера.

Чтобы посмотреть список доступных опций программы используйте опцию `--help`.

## Запуск в режиме сервера

Для запуска в режиме сервера используется опция `-s`:

```
./smarthome -s
```

Если вы работаете в windows, не указывайте `./` перед командой.

```
smarthome.exe -s
```

Обратите внимание, что имя файла при скачивании содержит название операционной системы, процессора и версию программы. Либо переименуйте скачанный файл, либо измените строку запуска соответствующим образом.

Дополнительно при запуске в режиме сервера можно указать следующие опции:
* `-p PORT` - номер порта, на котором сервер будет ожидать подключения. По умолчанию используется порт 9998.
* `-0 TIME` - начальное модельное время для симуляции в формате `YYYY-MM-DDThh:mm:ss`, например, `1984-04-01T13:00:00`. По умолчанию - текущее астрономическое время, округленное до секунд.
* `-1 DUR` - продолжительность моделирования, по умолчанию 1 час.
* `-S SCENARIO` - запустить сценарий с указанным номером. Сценарии описаны далее.

Если запуск был успешен, демо-сервер будет ожидать подключения на указанном порту. Проверить это можно, например, с помощью `curl`

```
curl -H POST -d "" localhost:9998
```

В ответ вы должны получить закодированную в base64 строку с сообщением с начальным модельным временем. Ответ сервера может выглядеть примерно так:

```
DbMG_38BBgaI0Kv6kzGK
```

## Сценарии работы

Версия 0.0.1 поддерживает только один сценарий работы.

### Сценарий 1

В этом сценарии в сети находится единственное устройство - таймер с именем `TIMER01`. Таймер шлёт сообщения о текущем времени каждые 100мс модельного времени.

## Кодирование и декодирование пакетов

Демо-сервер может использоваться как утилита для кодирования и декодирования пакетов.

Опция `-B` выполняет декодирование пакета из base64 в JSON-форму, например,

```
$ echo 'DbMG_38BBgaI0Kv6kzGK' | ./smarthome -B
[
    {
        "length": 13,
        "payload": {
            "src": 819,
            "dst": 16383,
            "serial": 1,
            "dev_type": 6,
            "cmd": 6,
            "cmd_body": {
                "timestamp": 1688984021000
            }
        },
        "crc8": 138
    }
]
```

Опция `-J` выполняет преобразование из JSON-представления в base64-представления для отправки.

```
$ ./smarthome -J
[
    {
        "length": 13,
        "payload": {
            "src": 819,
            "dst": 16383,
            "serial": 1,
            "dev_type": 6,
            "cmd": 6,
            "cmd_body": {
                "timestamp": 1688984021000
            }
        },
        "crc8": 138
    }
]
DbMG_38BBgaI0Kv6kzGK
```